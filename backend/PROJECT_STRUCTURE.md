<!-- prettier-ignore-start -->

# ğŸ“ Project Structure

```plaintext

app/
â”‚
â”œâ”€â”€ api/
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ dependencies.py
â”‚       â””â”€â”€ endpoints/
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ dependencies.py
â”‚   â”œâ”€â”€ enums.py
â”‚   â”œâ”€â”€ interfaces.py
â”‚   â”œâ”€â”€ responses.py
â”‚   â”œâ”€â”€ security.py
â”‚   â””â”€â”€ logging/
â”‚       â””â”€â”€ events.py
â”‚
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ base.py
â”‚   â”œâ”€â”€ session.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ focus.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â””â”€â”€ repositories/
â”‚       â”œâ”€â”€ base.py
â”‚       â”œâ”€â”€ focus_repo.py
â”‚       â””â”€â”€ user_repo.py
â”‚
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ oauth_user.py
â”‚   â”‚   â””â”€â”€ user.py
â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â””â”€â”€ user_role.py
â”‚   â”œâ”€â”€ exceptions/
â”‚   â”‚   â”œâ”€â”€ auth_exceptions.py
â”‚   â”‚   â””â”€â”€ base.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”‚   â”œâ”€â”€ email/
â”‚   â”‚   â””â”€â”€ logging_service.py
â”‚   â””â”€â”€ value_objects/
â”‚       â”œâ”€â”€ base.py
â”‚       â”œâ”€â”€ oauth.py
â”‚       â””â”€â”€ user.py
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ auth_providers/
â”‚   â”‚   â”œâ”€â”€ google_provider.py
â”‚   â”‚   â””â”€â”€ sqlalchemy_user_provider.py
â”‚   â”œâ”€â”€ messaging/
â”‚   â”‚   â””â”€â”€ rabbitmq/
â”‚   â””â”€â”€ sqla_persistence/
â”‚       â”œâ”€â”€ alembic/
â”‚       â”œâ”€â”€ mappings/
â”‚       â”‚   â”œâ”€â”€ oauth_mapping.py
â”‚       â”‚   â””â”€â”€ user_mapping.py
â”‚       â””â”€â”€ orm_registry.py
â”‚
â”œâ”€â”€ main.py
â”‚
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ auth.py
â”‚   â””â”€â”€ user.py
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ conftest.py
    â”œâ”€â”€ api/
    â”‚   â””â”€â”€ test_auth_endpoints.py
    â””â”€â”€ unit/
        â”œâ”€â”€ test_auth.py
        â””â”€â”€ test_security.py
```

# ğŸ“ Project Structure Overview

## ğŸ”¹ app/

Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ, Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ° Ğ¿Ğ¾ ÑĞ»Ğ¾ÑĞ¼ Ğ² Ğ´ÑƒÑ…Ğµ Clean Architecture.

### ğŸ“¦ api/

- **v1/endpoints/** â€” Ñ€Ğ¾ÑƒÑ‚ĞµÑ€Ñ‹ Ğ´Ğ»Ñ FastAPI. Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ñ‹ Ğ¿Ğ¾ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑĞ¼ (auth, user Ğ¸ Ñ‚.Ğ´.).
- **dependencies.py** â€” Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ FastAPI (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Depends Ğ´Ğ»Ñ DI).

### ğŸ“¦ core/

- **config.py** â€” ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· pydantic `BaseSettings`).
- **interfaces.py** â€” ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹/Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ğ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ñ‚Ğ¾ĞºĞµĞ½-ÑĞµÑ€Ğ²Ğ¸ÑĞ°, Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸ĞµĞ² Ğ¸ Ñ‚.Ğ¿.).
- **security.py** â€” Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸, Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ JWT Ğ¸ Ñ‚.Ğ¿.
- **logging/** â€” ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾Ğ³Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹.

### ğŸ“¦ db/

- **models/** â€” ORM Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ SQLAlchemy.
- **repositories/** â€” ÑĞ»Ğ¾Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰Ğ¸Ğµ Ñ ORM.
- **session.py** â€” Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº Ğ‘Ğ” Ñ‡ĞµÑ€ĞµĞ· SQLAlchemy.
- **base.py** â€” Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ²ĞµÑ‰Ğ¸ Ğ´Ğ»Ñ Ğ´ĞµĞºĞ»Ğ°Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°.

### ğŸ“¦ domain/

- **entities/** â€” Ğ±Ğ¸Ğ·Ğ½ĞµÑ-ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸ (Entities), Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‰Ğ¸Ğµ Ğ¾Ñ‚ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ¾Ğ².
- **value_objects/** â€” value object'Ñ‹, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ `Email`, `UserId`, `AvatarUrl` Ğ¸ Ñ‚.Ğ¿.
- **services/** â€” Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ, Ğ»Ğ¾Ğ³Ğ¸Ğ½, Ğ»Ğ¾Ğ³Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹).
- **enums/** â€” Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ñ€Ğ¾Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.
- **exceptions/** â€” Ğ´Ğ¾Ğ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ.

### ğŸ“¦ infrastructure/

- **auth_providers/** â€” Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² (Google, Email, Ğ¸ Ñ‚.Ğ¿.).
- **sqla_persistence/** â€” Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ ORM <-> Entity, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SQLAlchemy.
- **messaging/rabbitmq/** â€” Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ±Ñ€Ğ¾ĞºĞµÑ€Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹.

### ğŸ“¦ schemas/

- Pydantic-ÑÑ…ĞµĞ¼Ñ‹ (DTO), Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² API.

### ğŸ“¦ tests/

- ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸ API Ñ‚ĞµÑÑ‚Ñ‹.

---

# âš™ï¸ ĞœĞ¾Ğ´ĞµĞ»Ğ¸: Entity vs ORM vs Pydantic

## ğŸ”¹ ORM-Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (SQLAlchemy)

**Ğ“Ğ´Ğµ:** `app/db/models/`

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:

```python
class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True)
    email = Column(String, unique=True)
```

âœ… Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ” âŒ ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ² Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞµ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ

## ğŸ”¹ Entity (Ğ”Ğ¾Ğ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ)

**Ğ“Ğ´Ğµ:** `app/domain/entities/`

ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸. ĞĞµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ğ‘Ğ” Ğ¸Ğ»Ğ¸ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ¾Ğ².

```python
@dataclass
class User:
    id_: UserId
    email: Email
```

âœ… Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° âŒ ĞĞµ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ÑÑ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ

## ğŸ”¹ Pydantic-ÑÑ…ĞµĞ¼Ğ°

**Ğ“Ğ´Ğµ:** `app/schemas/`

ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ»Ñ API. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ/Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.

```python
class UserOut(BaseModel):
    id: int
    email: EmailStr
```

âœ… FastAPI Input/Output âŒ ĞĞµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ

---

# âœ… ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°ĞºÑƒÑ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ

| Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°                  | ĞœĞ¾Ğ´ĞµĞ»ÑŒ   |
| ----------------------- | -------- |
| Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”           | ORM      |
| Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ² Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞµ  | Entity   |
| Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ/Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ² API | Pydantic |

---

# ğŸ“Œ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸

1. `POST /api/auth/register` (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Pydantic EmailRegisterForm)
2. Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `auth_service.register_user(form_data)` â€” Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Entity/ValueObjects
3. Entity Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ñ‚ÑÑ Ğ² ORM Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² Ğ‘Ğ”
4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ UserOut (Pydantic) Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ

---
